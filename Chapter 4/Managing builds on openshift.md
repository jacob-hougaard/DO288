## Describing the Red Hat OpenShift Build Process



Redhats container platforms build process transformerer enten source kode og andre input parametre til container images der bliver tilgængelige for deployment på platformen.

For at bygge et container image kræver Openshift en BuildConfig resource. Configurationen for denne resource inkluderer en build strategi og et mere input såssom git, binary eller inline definitioner.



## Build Strategies

The following are the available build strategies in Red Hat OpenShift:

- Source-to-image (S2I) build
- Docker build
- Custom build

### Source2Image

Laver et nyt container image baseret på en applikations source kode. Dette er den nemme strategi-

### Docker build

Bruger ´buildah´ kommandoen til at bygge en ny container ud fra en Containerfile. Docker strategien kan hente fra et git repository. 

### Custom build

Specificerer et builder image ansvarlig for build processen. Denne strategi giver udviklere mulighed for at customizere byggeprocessen. 

## Build input sources

- `Containerfile`: Specifies the Containerfile inline to build an image.
- `Image`: You can provide additional files to the build process when you build from images.
- `Git`: Red Hat OpenShift clones the input  application source code from a Git repository. It is possible to  configure the default location inside the repository where the build  looks for application source code.
- `Binary`: Allows streaming binary content from a local file system to the builder.
- `Input secrets`: You can use input secrets to allow creating credentials for the build that are not available in the final application image.
- `External artifacts`: Allow copying binary files to the build process.

## BuildConfig resourcen

Definerer hvordan build processen foregår. BuildConfig resourcen definerer en build configuration og sætter triggers for hvornår Redhat openshift skal lave et nyt build.

Openshift genererer et Buildconfig gennem `oc new-app` kommandoen. Det kan også blive genereret vid brug af add to project knappen fra web konsollen.

The following example builds a PHP application using the `Source` strategy and a `Git` input source:

```
{
    "kind": "BuildConfig",
    "apiVersion": "v1",
    "metadata": {
        "name": "php-example", 
        ...output omitted...
    },
    "spec": {
        "triggers": [ 
            {
                "type": "GitHub",
                "github": {
                    "secret": "gukAWHzq1On4AJlMjvjS"  
                }
            },
            ...output omitted...
        ],
        "runPolicy": "Serial", 
        "source": { 
            "type": "Git",
            "git": {
                "uri": "http://services.lab.example.com/php-helloworld"
            }
        },
        "strategy": { 
            "type": "Source",
            "sourceStrategy": {
                "from": {
                    "kind": "ImageStreamTag",
                    "namespace": "openshift",
                    "name": "php:7.0"
                }
            }
        },
        "output": { 
            "to": {
                "kind": "ImageStreamTag",
                "name": "php-example:latest"
            }
        },
        ...output omitted...
    },
    ...output omitted...
}
```

| [![1](https://rol.redhat.com/rol/static/roc/Common_Content/images/1.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-1) | Defines a new `BuildConfig` named `php-example`.             |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [![2](https://rol.redhat.com/rol/static/roc/Common_Content/images/2.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-2) | Defines the triggers that start new builds.                  |
| [![3](https://rol.redhat.com/rol/static/roc/Common_Content/images/3.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-3) | Authorization string for the webhook, randomly generated by Red Hat OpenShift.  External applications send this string as part of the webhook URL to  trigger new builds. |
| [![4](https://rol.redhat.com/rol/static/roc/Common_Content/images/4.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-4) | The `runPolicy` attribute defines whether a build can start simultaneously. The `Serial` value represents that it is not possible to build simultaneously. |
| [![5](https://rol.redhat.com/rol/static/roc/Common_Content/images/5.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-5) | The `source` attribute is responsible for defining the input source of the build. In this example, it uses a Git repository. |
| [![6](https://rol.redhat.com/rol/static/roc/Common_Content/images/6.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-6) | Defines the build strategy to build the final container image. In this example, it uses the `Source` strategy. |
| [![7](https://rol.redhat.com/rol/static/roc/Common_Content/images/7.svg)](https://rol.redhat.com/rol/app/#building-describe-lecture-CO1-7) | The `output` attribute defines where to push the new container image after a successful build. |

